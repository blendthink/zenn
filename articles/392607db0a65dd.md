---
title: "Flutter ã®ç’°å¢ƒåˆ†ã‘ã®æ–°æ™‚ä»£"
emoji: "âš’ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "dart", "flavor"]
published: true
---

[Flutter Advent Calendar 2022] ã® 5 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

---

## ã¯ã˜ã‚ã«

ã¿ãªã•ã‚“ã€Flutter ã®ç’°å¢ƒåˆ†ã‘ã¯ã©ã®ã‚ˆã†ã«ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ

å¤šãã®æ–¹ã¯ã€å…¬å¼ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ flavor ã‚’ä½¿ã†æ–¹æ³•ã‚„ `--dart-define` ã‚’ä½¿ã†æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã‹ãªã¨æ€ã„ã¾ã™ã€‚

https://docs.flutter.dev/deployment/flavors

https://zenn.dev/altiveinc/articles/separating-environments-in-flutter

ä»Šå›ã€ç´¹ä»‹ã™ã‚‹ã®ã¯ `3.6.0-1.0.pre` ã§å°å…¥ã•ã‚ŒãŸ `--dart-define-from-file` ã‚’ä½¿ã†æ–¹æ³•ã§ã™ã€‚

:::message
`3.6.0-1.0.pre` ã¯ master ãƒ–ãƒ©ãƒ³ãƒã«ã‚¿ã‚°ã¥ã‘ã•ã‚Œã¦ã„ã‚‹ã ã‘ã§ã€æ­£å¼ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€é€”ä¸­ã§æ©Ÿèƒ½ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã”æ³¨æ„ãã ã•ã„ã€‚
:::

## `--dart-define-from-file` ãŒå°å…¥ã•ã‚ŒãŸèƒŒæ™¯

`--dart-define` ã‚’ä½¿ã†æ–¹æ³•ã ã¨æ¬¡ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚

- å¤šãã®å®šç¾©ãŒã‚ã‚‹å ´åˆã€èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ãŒéå¸¸ã«é•·ããªã£ã¦ã—ã¾ã†
- åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€ä¿å®ˆãŒå›°é›£ã«ãªã‚‹
- ã“ã‚Œã‚‰ã®å®šç¾©ã‚’ Android ã¨ iOS ã§ç›´æ¥åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãã‚Œãã‚Œã§ Base64 ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„

ã“ã‚Œã‚‰ã®èª²é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«å°å…¥ã•ã‚Œã¾ã—ãŸã€‚

### é–¢é€£ã™ã‚‹ Issue

https://github.com/flutter/flutter/issues/107810

https://github.com/flutter/flutter/issues/114296

### é–¢é€£ã™ã‚‹ Pull Request

https://github.com/flutter/flutter/pull/108098

https://github.com/flutter/flutter/pull/114297

## `--dart-define-from-file` ã®ä½¿ã„æ–¹

:::message
macOS ã¨ VS Code ã‚’åˆ©ç”¨ã™ã‚‹å‰æã§é€²ã‚ã¦ã„ãã¾ã™ã€‚ 
:::

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

https://github.com/blendthink/flutter-mobile-template

### Flutter ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`--dart-define-from-file` ã¯ã€ã¾ã æ­£å¼ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½ã§ã™ã€‚
ãã®ãŸã‚ã€ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å¯¾è±¡ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆ `3.6.0-1.0.pre` ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```shell
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆã—ã¦ç§»å‹•
mkdir flutter-mobile-template
cd flutter-mobile-template

# Flutter ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
git clone https://github.com/flutter/flutter.git --depth 1 -b "3.6.0-1.0.pre" ".flutter/flutter_sdk"
.flutter/flutter_sdk/bin/flutter --version

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«å«ã‚ãªã„ã‚ˆã†ã« .gitignore ã‚’ä½œæˆ
echo "flutter_sdk/" > .flutter/.gitignore
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```shell
.flutter/flutter_sdk/bin/flutter create \
    -t app \
    -i swift \
    -a kotlin \
    --platforms ios,android \
    --org dev.blendthink \
    --project-name flutter_mobile_template \
    .
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

ãã‚Œãã‚Œã®ç’°å¢ƒã”ã¨ã®è¨­å®šã‚’å®šç¾©ã—ã¾ã™ã€‚

```json:flavor/dev.json
{
  "flavor": "dev",
  "appId": "dev.blendthink.template",
  "appIdSuffix": "dev",
  "appName": "dev-Template",
  "bundleIdentifier": "dev.blendthink.template.dev"
}
```

```json:flavor/stg.json
{
  "flavor": "stg",
  "appId": "dev.blendthink.template",
  "appIdSuffix": "stg",
  "appName": "stg-Template",
  "bundleIdentifier": "dev.blendthink.template.stg"
}
```

```json:flavor/prd.json
{
  "flavor": "prd",
  "appId": "dev.blendthink.template",
  "appIdSuffix": "",
  "appName": "Template",
  "bundleIdentifier": "dev.blendthink.template"
}
```

### VS Code ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

Flutter SDK ã®ãƒ‘ã‚¹ã‚’è¨­å®šã—ã¦ã€`3.6.0-1.0.pre` ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```json:.vscode/settings.json
{
    "dart.flutterSdkPath": ".flutter/flutter_sdk",
    "search.exclude": {
        "**/.flutter": true
    },
    "files.watcherExclude": {
        "**/.flutter": true
    }
}
```

ãã‚Œãã‚Œã®ç’°å¢ƒã”ã¨ã®ãƒ‡ãƒãƒƒã‚°æ§‹æˆã‚’å®šç¾©ã—ã¾ã™ã€‚

https://code.visualstudio.com/docs/editor/debugging

```json:.vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "dart",
            "request": "launch",
            "name": "dev-debug",
            "args": [
                "--dart-define-from-file=flavor/dev.json"
            ]
        },
        {
            "type": "dart",
            "request": "launch",
            "name": "stg-debug",
            "args": [
                "--dart-define-from-file=flavor/stg.json"
            ]
        },
        {
            "type": "dart",
            "request": "launch",
            "name": "prd-debug",
            "args": [
                "--dart-define-from-file=flavor/prd.json"
            ]
        }
    ]
}
```

### Android ã®è¨­å®š

```diff:android/app/build.gradle
+def appId = project.property('appId')
+def appIdSuffix = project.property('appIdSuffix')
+def appName = project.property('appName')

 apply plugin: 'com.android.application'
 apply plugin: 'kotlin-android'
 apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"
 @@ -43,14 +47,13 @@ android {
     }

     defaultConfig {
         // TODO: Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).
         applicationId "dev.blendthink.flutter_mobile_template"
         // You can update the following values to match your application needs.
         // For more information, see: https://docs.flutter.dev/deployment/android#reviewing-the-gradle-build-configuration.
+        applicationId appId
+        applicationIdSuffix appIdSuffix
         minSdkVersion flutter.minSdkVersion
         targetSdkVersion flutter.targetSdkVersion
         versionCode flutterVersionCode.toInteger()
         versionName flutterVersionName
+        resValue "string", "app_name", appName
     }
```

```diff:android/app/src/main/AndroidManifest.xml
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
     package="dev.blendthink.flutter_mobile_template">
    <application
-        android:label="flutter_mobile_template"
+        android:label="@string/app_name"
         android:name="${applicationName}"
         android:icon="@mipmap/ic_launcher">
         <activity
```

### iOS ã®è¨­å®š

```diff:ios/Runner/Info.plist
 	<key>CFBundleDevelopmentRegion</key>
 	<string>$(DEVELOPMENT_LANGUAGE)</string>
 	<key>CFBundleDisplayName</key>
- 	<string>Flutter Mobile Template</string>
+ 	<string>$(appName)</string>
 	<key>CFBundleExecutable</key>
 	<string>$(EXECUTABLE_NAME)</string>
 	<key>CFBundleIdentifier</key>
- 	<string>$(PRODUCT_BUNDLE_IDENTIFIER)</string>
+ 	<string>$(bundleIdentifier)</string>
 	<key>CFBundleInfoDictionaryVersion</key>
 	<string>6.0</string>
 	<key>CFBundleName</key>
```

### ã‚¢ãƒ—ãƒªå®Ÿè¡Œ

VS Code ã® `Run and Debug` ã‹ã‚‰å®Ÿè¡Œã—ã¾ã™ã€‚

ã±ã£ã¨è¦‹ã§ã¯ç¢ºèªã—ã¥ã‚‰ã„ãŸã‚ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯æ¬¡ã®ã‚¹ãƒ†ã‚­ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸâœ¨

https://pub.dev/packages/package_info_plus

https://pub.dev/packages/simple_logger

ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ç¢ºèªã—ãŸã¨ã“ã‚ã€æ¬¡ã®ã‚ˆã†ã«ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸğŸ‰

```
flutter: ğŸ‘» INFO 2022-12-05 10:23:44.288258 [package:flutter_mobile_template/main.dart 9:10 in main] PackageInfo(appName: dev-Template, buildNumber: 1, packageName: dev.blendthink.template.dev, version: 1.0.0, buildSignature: , installerStore: com.apple.simulator)
```

## ãŠã‚ã‚Šã«

ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ

å€‹äººçš„ã«ã¯ã€ã¨ã¦ã‚‚ãƒ¡ãƒªãƒƒãƒˆãŒå¤šã„ã¨æ„Ÿã˜ãŸãŸã‚ã€æ­£å¼ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã‚‰ã“ã¡ã‚‰ã®æ–¹æ³•ã«ä¹—ã‚Šæ›ãˆã‚ˆã†ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚

ã¿ãªã•ã‚“ã‚‚ãœã²ãŠè©¦ã—ãã ã•ã„ã€‚

### ãŠã¾ã‘

ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ãƒ™ã‚¹ãƒˆã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2022ã«é¸å‡ºã•ã‚ŒãŸ Ado ã•ã‚“ã®ã€Œæ–°æ™‚ä»£ã€ã‹ã‚‰ã¤ã‘ã¾ã—ãŸã€‚

https://www.youtube.com/watch?v=nGsdH78_pXY

https://www.youtube.com/watch?v=1FliVTcX8bQ

å€‹äººçš„ã«ã¯ã¨ã¦ã‚‚å¥½ããªæ›²ã§ã€ä½œæ¥­ä¸­ã«ã‚ˆããƒªãƒ”ãƒ¼ãƒˆå†ç”Ÿã—ã¦è´ã„ã¦ã„ã¾ã™ã€‚
ã‚‚ã—è‰¯ã‘ã‚Œã°ã€ã¿ãªã•ã‚“ã‚‚ãœã²è´ã„ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚

<!-- Links -->

[Flutter Advent Calendar 2022]: https://qiita.com/advent-calendar/2022/flutter
